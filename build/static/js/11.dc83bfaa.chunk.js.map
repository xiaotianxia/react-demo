{"version":3,"sources":["request/api.js","utils/util.js","pages/login/Login.js"],"names":["HOST","request","path","param","ls","get","window","location","href","Promise","resolve","reject","fullUrl","parseTpl","serializeJson","client_id","client_secret","fetch","then","r","text","res","JSON","parse","message","error","catch","err","getUser","getRepos","getFollowing","getFollowers","getInfo","getRepoDetail","getEvents","template","context","replace","match","key","trim","json","Object","entries","map","item","join","cutStr","val","length","substr","LoginForm","state","loading","handleSubmit","e","preventDefault","props","form","validateFields","values","setState","username","api","data","this","id","dispatch","onLogin","login","history","goBack","push","getFieldDecorator","logined","to","className","onSubmit","Item","rules","required","prefix","type","style","color","placeholder","allowClear","textAlign","htmlType","React","Component","WrappedRegistrationForm","Form","create","name","Login","withRouter","connect","loginUserChange"],"mappings":"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","file":"static/js/11.dc83bfaa.chunk.js","sourcesContent":["import { parseTpl, serializeJson } from '@/utils/util';\nimport {\n    message\n} from 'antd';\nimport { ls } from '@utils/localStorage';\nconst HOST = 'https://api.github.com';\n\nfunction request(path, param) {\n    const username = ls.get('my_github_app_username');\n    if (!username) {\n        window.location.href = '/#/login';\n    }\n    return new Promise((resolve, reject) => {\n        let fullUrl = parseTpl(HOST + path, param);\n        fullUrl = fullUrl + '?' + serializeJson({\n            ...param,\n            client_id: 'aa18248a5e12eca15a6f',\n            client_secret: '389eac9e777a6ced5127b45193640580174c426d'\n        })\n        fetch(fullUrl).then(r => r.text().then(res => {\n            res = JSON.parse(res);\n            if (res.message) {\n                message.error(res.message || '接口出错');\n            }\n            resolve(res);\n        })).catch(err => {\n            reject(err);\n        });\n    });\n}\n\nexport default {\n    getUser(param) {\n        return request('/users/{{username}}', param);\n    },\n\n    getRepos(param) {\n        return request('/users/{{username}}/repos', param);\n    },\n\n    getFollowing(param) {\n        return request('/users/{{username}}/following', param);\n    },\n\n    getFollowers(param) {\n        return request('/users/{{username}}/followers', param);\n    },\n\n    getInfo(param) {\n        return request('/users/{{username}}', param);\n    },\n\n    getRepoDetail(param) {\n        return request('/repos/{{username}}/{{repo}}', param);\n    },\n\n    getEvents(param) {\n        return request('/users/{{username}}/events', param);\n    }\n};","export const parseTpl = (template, context) => {\n    return template.replace(/\\{\\{(.*?)\\}\\}/g, (match, key) => context[key.trim()]);\n}\n\nexport const serializeJson = (json) => {\n    return Object.entries(json).map(item => {\n        return `${item[0]}=${item[1]}`\n    }).join('&')\n}\n\nexport const cutStr = (val, length = 30) => {\n    if (val && val.length > length) {\n        return `${val.substr(0, length)}...`;\n    }\n    return val;\n}","import React from 'react';\nimport { \n    Form,\n    Icon,\n    Input,\n    Button,\n} from 'antd';\nimport './login.scss';\nimport api from '@api';\nimport { withRouter, Redirect } from 'react-router-dom';\nimport { connect } from 'react-redux';\nimport { onLogin } from '@/redux/actions';\n\nclass LoginForm extends React.Component {\n    state = {\n        loading: false\n    }\n\n    handleSubmit = e => {\n        e.preventDefault();\n        this.props.form.validateFields((err, values) => {\n            if (!err) {\n                this.setState({ loading: true} );\n                this.getUser(values.username);\n            }\n        });\n    };\n\n    async getUser(username) {\n        const data = await api.getUser({ username });\n        this.setState({ loading: false });\n        if (data.id) {\n            this.props.dispatch(onLogin({ username: data.login }));\n            this.props.history.goBack() || this.props.history.push('repos');\n        }\n    }\n\n    render() {\n        const { getFieldDecorator } = this.props.form;\n        if (this.props.logined) {\n            return (<Redirect to=\"repos\" />);\n        } else {\n            return <div className=\"login\">\n                <Form onSubmit={this.handleSubmit} className=\"login-form\">\n                    <Form.Item>\n                        {getFieldDecorator('username', {\n                            rules: [{ required: true, message: 'Please input your username!' }],\n                        })(\n                            <Input\n                                prefix={<Icon type=\"user\" style={{ color: 'rgba(0,0,0,.25)' }} />}\n                                placeholder=\"Username\"\n                                allowClear\n                            />,\n                        )}\n                    </Form.Item>\n                    <Form.Item style={{ textAlign: 'center' }}>\n                        <Button type=\"primary\" loading={this.state.loading} htmlType=\"submit\">Log in</Button>\n                    </Form.Item>\n                </Form>\n                <div className=\"login-mask\"></div>\n            </div>\n        }\n    }\n}\n\nconst WrappedRegistrationForm = Form.create({ name: 'login' })(LoginForm);\nconst Login =  withRouter(WrappedRegistrationForm);\n\nexport default connect(\n    state => state.loginUserChange\n)(Login);"],"sourceRoot":""}